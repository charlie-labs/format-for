# format-for

[![CI](https://github.com/charlie-labs/format-for/actions/workflows/ci.yml/badge.svg?branch=master)](https://github.com/charlie-labs/format-for/actions/workflows/ci.yml)
[![Bun](https://img.shields.io/badge/bun-1.x-000)](https://bun.sh)

> Visibility: **private** • Package: `format-for`

A minimal, fast Bun + TypeScript project scaffold with consistent tooling:

> **Default branch:** Repos created from this template inherit the `master` branch. Rename it to `main` after initialization if that matches your workflow.

- TypeScript (ESM, strict)
- ESLint + Prettier for linting/formatting
- Bun test runner
- Husky + lint-staged pre-commit checks
- GitHub Actions CI (typecheck, lint, test)
- Build & metadata tooling: `bun run build` drives `zshy` (configured via the `"zshy"` key in package.json) to emit dual CJS/ESM bundles; CI also runs `bun run build` to regenerate `package.json` metadata and catch drift

This repo was initialized from `charlie-labs/bun-lib-template`.

---

## Table of contents

- [Getting started](#getting-started)
- [Scripts](#scripts)
- [Project structure](#project-structure)
- [Development](#development)
- [Testing](#testing)
- [CI](#ci)
- [Configuration](#configuration)
- [Conventions](#conventions)
- [Keeping up to date](#keeping-up-to-date)
- [Releasing](#releasing-optional)
- [License](#license)

---

## Getting started

### Prerequisites

- **Bun** 1.x (`curl -fsSL https://bun.sh/install | bash`)

### Setup

```bash
# Install dependencies
bun install

# Verify everything is wired
bun run typecheck
bun run lint
bun test
```

---

## Scripts

Common tasks (see `package.json` for the full list):

- `build`: `bun run --bun zshy` — runs the `zshy` bundler (configured via the `"zshy"` field) to emit dual CJS/ESM bundles
- `ci`: `bun run typecheck && bun run lint && bun run test`
- `fix`: `eslint --fix --quiet . ; prettier --write --log-level=silent .`
- `lint`: `eslint . && prettier --check .`
- `test`: `bun test`
- `typecheck`: `tsc --noEmit`

Usage:

```bash
bun run typecheck # TS type checks, no emit
bun run lint      # static analysis + Prettier check
bun run fix       # auto-fix lint + format issues
bun test      # unit tests with Bun
bun run build     # emit CJS/ESM bundles via zshy (see package.json#"zshy")
```

---

## Project structure

```
.
├─ src/
│  ├─ index.ts
│  └─ index.test.ts
├─ .github/workflows/
│  └─ ci.yml
├─ eslint.config.js
├─ knip.ts
├─ tsconfig.json
├─ bun.lock
├─ .prettierignore
├─ package.json
└─ README.md
```

> This project tracks the text-based `bun.lock` generated by `bun install --save-text-lock`. Run `bun install` after dependency changes to refresh it.

---

## Development

- **ESM-only**. Use explicit `.js` extensions on local imports when bundling TypeScript.
- Keep modules small and pure; push side effects to the entry point.
- Example pattern:

```ts
export function helloWorld(): string {
  return 'Hello World!';
}

if (import.meta.main) {
  console.log(helloWorld());
}
```

---

## Testing

- Tests run with `bun test`.
- Co-locate specs beside source (e.g., `src/index.test.ts`).

```ts
import { expect, test } from 'bun:test';
import { helloWorld } from './index.js';

test('helloWorld', () => {
  expect(helloWorld()).toBe('Hello World!');
});
```

---

## CI

- CI runs on PRs and the `master` branch.
- Workflow: `.github/workflows/ci.yml`
  - `bun install --frozen-lockfile`
  - `bun run build` to ensure `package.json` is current (via zshy)
  - `bun run ci` (typecheck, lint, test)

Badge at the top links to the current workflow run history.

> Prefer `main` as your default branch? Rename it (`git branch -m master main`) and update the badge + workflow triggers.

---

## Configuration

This template avoids runtime envs by default. If you need them:

1. Define a schema (e.g., Zod) and validate at startup.
2. Document required variables here.

Example:

```ts
export interface AppConfig {
  port: number;
}

export function loadConfig(env = process.env): AppConfig {
  const port = Number(env.PORT ?? '3000');
  if (!Number.isFinite(port) || port <= 0) {
    throw new Error('PORT must be a positive integer');
  }
  return { port };
}
```

---

## Conventions

- **Formatting/linting**: ESLint + Prettier (`bun run lint`, `bun run fix`)
- **Type safety**: `bun run typecheck` locally and in CI
- **Commits/PRs**: Keep PRs focused; include tests or rationale for behavior changes.

---

## Keeping up to date

If you enable the optional weekly “template sync” automation, shared files (e.g., `ci.yml`, `eslint.config.js`, `knip.ts`, `tsconfig.json`, `.prettierignore`) will be proposed via PR. Review and merge as needed. Project-specific code is never auto-overwritten.

---

## Releasing (optional)

If you convert this to a library and add a release process (e.g., Changesets), document it here:

- Versioning strategy
- Publishing target (npm, GitHub Releases)
- Required tokens/permissions

---

## License

Update this section once you choose a license for your project.
